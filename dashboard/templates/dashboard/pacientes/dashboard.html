{% extends './base.html' %}
{% load django_vite %}
{% load static %}

{% block head %}
  <title>Página Inicial</title>
  <script type="module" src="{% vite_asset_url 'static/js/datatables.js' %}"></script>
  <link rel="stylesheet" href="{% vite_asset_url 'static/css/datatables.css' %}" />
{% endblock %}

{% block main %}
  <div class="md:grid grid-cols-2 md:grid-cols-2 bg-base-200 border-1 border-gray-300 rounded-md p-6 gap-2">
    <div class="flex flex-col text-left gap-y-2 w-full">
      <p class="text-4xl font-normal">Bem-vindo, {{ user.username }}!</p>
      <p class="text-xl font-normal">Você está vendo está página como um paciente.</p>
    </div>
    <div class="flex flex-col text-right gap-y-2 w-full">
      <p class="text-3xl font-normal" id="realtime"></p>
      <p class="text-xl font-normal">{{ data_atual }}</p>
    </div>
  </div>
  <br />

  <div class="grid grid-cols-4 gap-4">
    <div class="col-span-3 overflow-x-auto">
      <div class="flex md:flex-col items-start bg-base-200 border-t-1 border-r-1 border-l-1 border-gray-300 p-3">
        <h2 class="text-lg font-semibold">Seus Agendamentos</h2>
      </div>
      <table class="table bg-base-200 border-1 border-gray-300" id="pagination-table">
        <thead>
          <tr>
            <th>
              <span class="flex items-center">Nome</span>
            </th>
            <th>
              <span class="flex items-center">Data</span>
            </th>
            <th>
              <span class="flex items-center">Status</span>
            </th>
          </tr>
        </thead>
        <tbody>
          {% for eventos in eventos_lista %}
            <tr>
              <td>
                <div class="flex items-center gap-3">
                  <div class="avatar">
                    <div class="mask mask-squircle h-12 w-12">
                      {% if eventos.paciente.avatar %}
                        <img src="{{ eventos.paciente.avatar.url }}" alt="Avatar" />
                      {% else %}
                        <img src="{% static 'default-avatar.png' %}" alt="Avatar Padrão" />
                      {% endif %}
                    </div>
                  </div>
                  <div>
                    <div class="font-medium">
                      {% if eventos.paciente.username %}
                        {{ eventos.paciente.username }}
                      {% else %}
                        Nenhum agendamento
                      {% endif %}
                    </div>
                  </div>
                </div>
              </td>
              <td>
                {% if eventos.data_inicio %}
                  {{ eventos.data_inicio|date:'d/m/Y H:i' }}
                {% else %}
                  Sem data
                {% endif %}
              </td>
              <td>
                <div class="flex items-center">
                  {% if eventos.status == 'AGENDADO' %}
                    <span class="inline-flex items-center gap-x-1.5 rounded-md bg-gray-200/40 px-2 py-1 text-xs font-medium text-gray-900 ring-1 ring-inset ring-gray-500/10">
                      <svg class="h-1.5 w-1.5 fill-blue-500" viewBox="0 0 6 6" aria-hidden="true">
                        <circle cx="3" cy="3" r="3" />
                      </svg>Agendado
                    </span>
                  {% elif eventos.status == 'PEDIDO' %}
                    <span class="inline-flex items-center gap-x-1.5 rounded-md bg-gray-200/40 px-2 py-1 text-xs font-medium text-gray-900 ring-1 ring-inset ring-gray-500/10">
                      <svg class="h-1.5 w-1.5 fill-orange-500" viewBox="0 0 6 6" aria-hidden="true">
                        <circle cx="3" cy="3" r="3" />
                      </svg>Pedido
                    </span>
                  {% elif eventos.status == 'CONFIRMADO' %}
                    <span class="inline-flex items-center gap-x-1.5 rounded-md bg-gray-200/40 px-2 py-1 text-xs font-medium text-gray-900 ring-1 ring-inset ring-gray-500/10">
                      <svg class="h-1.5 w-1.5 fill-green-500" viewBox="0 0 6 6" aria-hidden="true">
                        <circle cx="3" cy="3" r="3" />
                      </svg>Confirmado
                    </span>
                  {% elif eventos.status == 'CANCELADO' %}
                    <span class="inline-flex items-center gap-x-1.5 rounded-md bg-gray-200/40 px-2 py-1 text-xs font-medium text-gray-900 ring-1 ring-inset ring-gray-500/10">
                      <svg class="h-1.5 w-1.5 fill-red-500" viewBox="0 0 6 6" aria-hidden="true">
                        <circle cx="3" cy="3" r="3" />
                      </svg>Cancelado
                    </span>
                  {% elif eventos.status == 'AUSENTE' %}
                    <span class="inline-flex items-center gap-x-1.5 rounded-md bg-gray-200/40 px-2 py-1 text-xs font-medium text-gray-900 ring-1 ring-inset ring-gray-500/10">
                      <svg class="h-1.5 w-1.5 fill-gray-500" viewBox="0 0 6 6" aria-hidden="true">
                        <circle cx="3" cy="3" r="3" />
                      </svg>Ausente
                    </span>
                  {% else %}
                    <span class="badge badge-ghost">Sem Status</span>
                  {% endif %}
                </div>
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="4" class="text-center">Nenhum agendamento encontrado</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="col-span-1 overflow-x-auto">
      <div class="flex md:flex-col items-start bg-base-200 border-t-1 border-r-1 border-l-1 border-gray-300 p-3">
        <h2 class="text-lg font-semibold">Suas Consultas</h2>
      </div>
      <table class="table bg-base-200 border-1 border-gray-300" id="pagination-table-2">
        <thead>
          <tr>
            <th>
              <span class="flex items-center">Nome</span>
            </th>
            <th>
              <span class="flex items-center">Data</span>
            </th>
          </tr>
        </thead>
        <tbody>
          {% for eventos in eventos_lista_pedidos %}
            <tr>
              <td>
                <div class="flex items-center gap-3">
                  <div class="avatar">
                    <div class="mask mask-squircle h-12 w-12">
                      {% if eventos.paciente.avatar %}
                        <img src="{{ eventos.paciente.avatar.url }}" alt="Avatar" />
                      {% else %}
                        <img src="{% static 'default-avatar.png' %}" alt="Avatar Padrão" />
                      {% endif %}
                    </div>
                  </div>
                  <div>
                    <div class="font-medium">
                      {% if eventos.paciente.username %}
                        {{ eventos.paciente.username }}
                      {% else %}
                        Nenhum agendamento
                      {% endif %}
                    </div>
                  </div>
                </div>
              </td>
              <td>
                {% if eventos.data_fim %}
                  {{ eventos.data_fim|date:'d/m/Y H:i' }}
                {% else %}
                  Sem data
                {% endif %}
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="4" class="text-center">Nenhum agendamento encontrado</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
        <div class="flex md:flex-col items-center bg-base-200 border-r-1 border-b-1 border-l-1 border-gray-300 p-3">
        <a href="{% url "dashboard:create_agenda_pac" %}"><button class="btn btn-sm btn-outline btn-primary">Marcar Consulta</button></a>
      </div>
    </div>
  </div>


  </div>
</div>

  <script>
    function updateClock() {
      const now = new Date()
      const timeString = now.toLocaleTimeString('pt-BR', {
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit',
        hour12: false
      })
      const realtimeElement = document.getElementById('realtime')
      if (realtimeElement) {
        realtimeElement.textContent = timeString
      }
    }
    
    updateClock()
    setInterval(updateClock, 1000)
  </script>
{% endblock %}
